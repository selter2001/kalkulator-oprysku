---
phase: 01-foundation-mvvm
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - SprayCalculator/SprayCalculatorApp.swift
  - SprayCalculator/Models.swift
  - SprayCalculator/LocalizationManager.swift
  - SprayCalculator/HistoryManager.swift
  - SprayCalculator/FavoritesManager.swift
  - SprayCalculator/Colors.swift
  - SprayCalculator/Components.swift
  - SprayCalculator/TractorAnimation.swift
  - SprayCalculator/ContentView.swift
  - SprayCalculator/HistoryView.swift
  - SprayCalculator/FavoritesView.swift
  - SprayCalculator/SettingsView.swift
  - SprayCalculator/CalculatorView.swift
  - SprayCalculator.xcodeproj/project.pbxproj
  - SprayCalculator/Assets.xcassets
autonomous: true

must_haves:
  truths:
    - "Caly kod zrodlowy aplikacji istnieje w repozytorium projektu"
    - "Trzy managery (LocalizationManager, HistoryManager, FavoritesManager) uzywaja @Observable zamiast ObservableObject/@Published"
    - "SprayCalculatorApp wstrzykuje serwisy przez .environment() zamiast .environmentObject()"
    - "Wszystkie widoki uzywaja @Environment(Type.self) zamiast @EnvironmentObject"
    - "Martwy plik CalculatorView.swift jest usuniety z projektu"
    - "Projekt kompiluje sie bez bledow z SWIFT_VERSION 5.0 i deployment target iOS 17.0"
  artifacts:
    - path: "SprayCalculator/SprayCalculatorApp.swift"
      provides: "App entry z @State + .environment() zamiast @StateObject + .environmentObject()"
    - path: "SprayCalculator/LocalizationManager.swift"
      provides: "@Observable LocalizationManager"
    - path: "SprayCalculator/HistoryManager.swift"
      provides: "@Observable HistoryManager"
    - path: "SprayCalculator/FavoritesManager.swift"
      provides: "@Observable FavoritesManager"
  key_links:
    - from: "SprayCalculatorApp.swift"
      to: "LocalizationManager, HistoryManager, FavoritesManager"
      via: ".environment() injection"
      pattern: "\\.environment\\("
    - from: "ContentView.swift, HistoryView.swift, FavoritesView.swift, SettingsView.swift"
      to: "LocalizationManager, HistoryManager, FavoritesManager"
      via: "@Environment(Type.self)"
      pattern: "@Environment\\(.+\\.self\\)"
---

<objective>
Skopiowac kod zrodlowy aplikacji do repozytorium, usunac martwy plik CalculatorView.swift, i zmigrowac wszystkie serwisy z ObservableObject/@Published na @Observable macro (iOS 17+). Zaktualizowac wszystkie widoki z @EnvironmentObject na @Environment(Type.self).

Purpose: Bez kodu w repozytorium nic nie mozna zbudowac. Migracja @Observable jest fundamentem -- bez niej CalcViewModel (Plan 02) nie moze uzyc nowego wzorca. To jest "zero do jedynki" plan.
Output: Kompilujacy sie projekt z @Observable serwisami i wszystkimi widokami uzywajacymi nowego wzorca DI.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-mvvm/01-RESEARCH.md

Istniejacy kod zrodlowy do skopiowania z: /Users/wojciecholszak/Downloads/SprayCalculator-2/
Struktura: SprayCalculator/ (13 plikow Swift + Assets.xcassets) + SprayCalculator.xcodeproj/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Skopiowac kod zrodlowy i usunac martwy plik</name>
  <files>
    SprayCalculator/ (caly folder)
    SprayCalculator.xcodeproj/ (caly folder)
  </files>
  <action>
1. Skopiowac caly folder `/Users/wojciecholszak/Downloads/SprayCalculator-2/SprayCalculator/` do katalogu projektu `/Users/wojciecholszak/Desktop/Kalkulator Oprysku/SprayCalculator/`
2. Skopiowac caly folder `/Users/wojciecholszak/Downloads/SprayCalculator-2/SprayCalculator.xcodeproj/` do katalogu projektu `/Users/wojciecholszak/Desktop/Kalkulator Oprysku/SprayCalculator.xcodeproj/`
3. Usunac plik `SprayCalculator/CalculatorView.swift` -- jest to martwy kod, NIEUZYWANY w aplikacji. Faktyczny kalkulator to `CalculatorViewWithFavorite` w `ContentView.swift`.
4. Usunac referencje do CalculatorView.swift z `project.pbxproj`:
   - Usunac linie z `A1000011` (PBXBuildFile) i `B1000011` (PBXFileReference)
   - Usunac `B1000011` z PBXGroup children
   - Usunac `A1000011` z PBXSourcesBuildPhase files
5. NIE kopiowac pliku README.md ani AppIcon.svg z Downloads (nie sa potrzebne w tym planie).
  </action>
  <verify>
ls -la SprayCalculator/*.swift | wc -l  # Powinno byc 12 (nie 13 -- bez CalculatorView.swift)
grep -c "CalculatorView.swift" SprayCalculator.xcodeproj/project.pbxproj  # Powinno byc 0
grep -c "A1000011\|B1000011" SprayCalculator.xcodeproj/project.pbxproj  # Powinno byc 0
  </verify>
  <done>12 plikow Swift w SprayCalculator/, zero referencji do CalculatorView.swift w pbxproj</done>
</task>

<task type="auto">
  <name>Task 2: Migrowac serwisy na @Observable i zaktualizowac DI we wszystkich widokach</name>
  <files>
    SprayCalculator/LocalizationManager.swift
    SprayCalculator/HistoryManager.swift
    SprayCalculator/FavoritesManager.swift
    SprayCalculator/SprayCalculatorApp.swift
    SprayCalculator/ContentView.swift
    SprayCalculator/HistoryView.swift
    SprayCalculator/FavoritesView.swift
    SprayCalculator/SettingsView.swift
  </files>
  <action>
**Migracja serwisow (3 pliki):**

1. `LocalizationManager.swift`:
   - Dodac `import Observation` na gorze pliku
   - Zamienic `class LocalizationManager: ObservableObject` na `@Observable class LocalizationManager`
   - Usunac `@Published` z `var currentLanguage: Language` -- `@Observable` automatycznie sledzi zmiany propertek
   - Zachowac `didSet` na `currentLanguage` (zapis do UserDefaults) -- dziala z @Observable

2. `HistoryManager.swift`:
   - Dodac `import Observation`
   - Zamienic `class HistoryManager: ObservableObject` na `@Observable class HistoryManager`
   - Usunac `@Published` z `var calculations: [SprayCalculation] = []`
   - Zmienic `import SwiftUI` na `import Foundation` (nie potrzebuje SwiftUI)

3. `FavoritesManager.swift`:
   - Dodac `import Observation`
   - Zamienic `class FavoritesManager: ObservableObject` na `@Observable class FavoritesManager`
   - Usunac `@Published` z `var favorites: [FavoriteConfiguration] = []`
   - Zmienic `import SwiftUI` na `import Foundation` (nie potrzebuje SwiftUI)

**Aktualizacja App (1 plik):**

4. `SprayCalculatorApp.swift`:
   - Zamienic 3x `@StateObject private var` na `@State private var`
   - Zamienic 3x `.environmentObject(...)` na `.environment(...)`
   - Wynik:
     ```swift
     @State private var localization = LocalizationManager()
     @State private var historyManager = HistoryManager()
     @State private var favoritesManager = FavoritesManager()
     // ...
     .environment(localization)
     .environment(historyManager)
     .environment(favoritesManager)
     ```

**Aktualizacja widokow (4 pliki):**

5. `ContentView.swift`:
   - Zamienic 3x `@EnvironmentObject var xxx: Type` na `@Environment(Type.self) private var xxx`
   - W `CalculatorViewWithFavorite`: zamienic 3x `@EnvironmentObject var xxx: Type` na `@Environment(Type.self) private var xxx`
   - W Preview na dole: zamienic `.environmentObject(...)` na `.environment(...)`

6. `HistoryView.swift`:
   - Zamienic `@EnvironmentObject var localization: LocalizationManager` na `@Environment(LocalizationManager.self) private var localization`
   - Zamienic `@EnvironmentObject var historyManager: HistoryManager` na `@Environment(HistoryManager.self) private var historyManager`
   - W Preview: zamienic `.environmentObject(...)` na `.environment(...)`

7. `FavoritesView.swift`:
   - W `FavoritesView`: zamienic 2x `@EnvironmentObject` na `@Environment(Type.self)`
   - W `FavoriteRowView`: zamienic `@EnvironmentObject var localization: LocalizationManager` na `@Environment(LocalizationManager.self) private var localization`
   - W Preview: zamienic `.environmentObject(...)` na `.environment(...)`

8. `SettingsView.swift`:
   - Zamienic `@EnvironmentObject var localization: LocalizationManager` na `@Environment(LocalizationManager.self) private var localization`
   - W Preview: zamienic `.environmentObject(...)` na `.environment(...)`

**WAZNE -- Anti-patterny do unikania:**
- NIE mieszac @Observable z @StateObject/@ObservedObject (obserwacja po cichu sie psuje)
- NIE zostawiac @Published wewnatrz @Observable klas (jest ignorowany)
- NIE uzywac @EnvironmentObject z @Observable klasami
- Po kazdym pliku sprawdzic ze nie zostaly zadne stare wzorce
  </action>
  <verify>
grep -r "@EnvironmentObject" SprayCalculator/ | wc -l  # Powinno byc 0
grep -r "@StateObject" SprayCalculator/ | wc -l  # Powinno byc 0
grep -r "@Published" SprayCalculator/ | wc -l  # Powinno byc 0
grep -r "ObservableObject" SprayCalculator/ | wc -l  # Powinno byc 0
grep -r "@Environment(" SprayCalculator/*.swift | grep -c "\.self)"  # Powinno byc > 0 (nowy wzorzec)
grep -c "\.environment(" SprayCalculator/SprayCalculatorApp.swift  # Powinno byc 3
grep -c "@Observable" SprayCalculator/LocalizationManager.swift SprayCalculator/HistoryManager.swift SprayCalculator/FavoritesManager.swift  # 1 na plik
  </verify>
  <done>Zero starych wzorcow (@EnvironmentObject, @StateObject, @Published, ObservableObject) w calym projekcie. Wszystkie 3 serwisy uzywaja @Observable. Aplikacja kompilowalna.</done>
</task>

</tasks>

<verification>
1. Zero instancji starych wzorcow w calym projekcie: `grep -rE "@EnvironmentObject|@StateObject|@Published|ObservableObject" SprayCalculator/` zwraca pusty wynik
2. Trzy serwisy maja @Observable: `grep -l "@Observable" SprayCalculator/*.swift` zwraca 3 pliki
3. SprayCalculatorApp uzywa @State + .environment(): widoczne w pliku
4. CalculatorView.swift nie istnieje: `ls SprayCalculator/CalculatorView.swift` zwraca blad
5. pbxproj nie ma referencji do CalculatorView: grep zwraca 0
6. Xcode build: `xcodebuild -project SprayCalculator.xcodeproj -scheme SprayCalculator -destination 'platform=iOS Simulator,name=iPhone 16' build` (jesli dostepne)
</verification>

<success_criteria>
- 12 plikow Swift w repozytorium (bez martwego CalculatorView.swift)
- Wszystkie 3 serwisy: @Observable class (bez ObservableObject/@Published)
- App: @State + .environment() (bez @StateObject + .environmentObject())
- Widoki: @Environment(Type.self) (bez @EnvironmentObject)
- Projekt buduje sie bez bledow
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-mvvm/01-01-SUMMARY.md`
</output>
