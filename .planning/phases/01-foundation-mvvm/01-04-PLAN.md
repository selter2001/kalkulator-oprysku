---
phase: 01-foundation-mvvm
plan: 04
type: execute
wave: 3
depends_on: ["01-03"]
files_modified:
  - SprayCalculator/HistoryView.swift
  - SprayCalculator/SettingsView.swift
  - SprayCalculator/TractorAnimation.swift
  - SprayCalculator/LocalizationManager.swift
autonomous: false

must_haves:
  truths:
    - "Przelaczenie jezyka na angielski pokazuje w pelni angielski UI na kazdym ekranie -- zero hardcoded polskiego tekstu"
    - "HistoryRowView wyswietla 'Working fluid', 'Chemical', 'Tank fills' po angielsku (nie 'Ciecz robocza', 'Srodek', 'Napelnienia')"
    - "HistoryRowView tankFillsText wyswietla 'full' / 'partial' po angielsku (nie 'pelne' / 'czesciowe')"
    - "SettingsView wyswietla 'Version' / 'Information' po angielsku (nie 'Wersja' / 'Informacje')"
    - "Animacja traktora wyswietla 'Calculating...' po angielsku (nie 'Obliczanie...')"
    - "Istniejaca funkcjonalnosc dziala: historia, ulubione, animacja, walidacja, per-tank composition"
  artifacts:
    - path: "SprayCalculator/LocalizationManager.swift"
      provides: "Nowe klucze: version, information, calculating, workingFluidLabel, chemicalLabel, tankFillsLabel"
    - path: "SprayCalculator/HistoryView.swift"
      provides: "HistoryRowView z @Environment(LocalizationManager.self) i zlokalizowanymi labelami"
    - path: "SprayCalculator/SettingsView.swift"
      provides: "Zlokalizowane 'Wersja'/'Version' i 'Informacje'/'Information'"
    - path: "SprayCalculator/TractorAnimation.swift"
      provides: "Zlokalizowane 'Obliczanie...'/'Calculating...'"
  key_links:
    - from: "HistoryRowView"
      to: "LocalizationManager"
      via: "@Environment(LocalizationManager.self)"
      pattern: "@Environment\\(LocalizationManager\\.self\\)"
    - from: "TractorAnimation"
      to: "Localized calculating text"
      via: "Parameter passed from parent or @Environment"
      pattern: "calculating"
---

<objective>
Naprawic wszystkie hardcoded polskie stringi w HistoryRowView, SettingsView i TractorAnimation. Dodac brakujace klucze lokalizacji. Zweryfikowac ze cala aplikacja dziala po angielsku bez zadnych polskich tekstow.

Purpose: Uzytkownik anglojezyczny musi widziec w pelni przetlumaczona aplikacje. Hardcoded polskie stringi lamia UX. To jest ostatni plan fazy -- domyka FIX-01, FIX-02 i weryfikuje calosciowa integralnosc.
Output: W pelni zlokalizowana aplikacja PL/EN. Zero hardcoded polskich stringow w widokach.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-mvvm/01-RESEARCH.md
@.planning/phases/01-foundation-mvvm/01-01-SUMMARY.md
@.planning/phases/01-foundation-mvvm/01-02-SUMMARY.md
@.planning/phases/01-foundation-mvvm/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Naprawic lokalizacje w HistoryRowView, SettingsView i TractorAnimation</name>
  <files>
    SprayCalculator/LocalizationManager.swift
    SprayCalculator/HistoryView.swift
    SprayCalculator/SettingsView.swift
    SprayCalculator/TractorAnimation.swift
  </files>
  <action>
**1. Dodac brakujace klucze do LocalizationManager.swift:**

Dodac nastepujace computed properties (jesli nie zostaly juz dodane w Planie 02 lub 03):

```swift
// Klucze dla HistoryRowView
var workingFluidLabel: String {
    currentLanguage == .polish ? "Ciecz robocza" : "Working fluid"
}

var chemicalLabel: String {
    currentLanguage == .polish ? "Środek" : "Chemical"
}

var tankFillsLabel: String {
    currentLanguage == .polish ? "Napełnienia" : "Tank fills"
}

// Klucze dla SettingsView
var version: String {
    currentLanguage == .polish ? "Wersja" : "Version"
}

var information: String {
    currentLanguage == .polish ? "Informacje" : "Information"
}

// Klucz dla TractorAnimation
var calculating: String {
    currentLanguage == .polish ? "Obliczanie..." : "Calculating..."
}
```

UWAGA: LocalizationManager moze juz miec `workingFluid` i `chemical` -- to sa istniejace klucze uzywane w resultsSection. Jesli `workingFluid` juz istnieje i ma poprawne tlumaczenie, mozna go ponownie uzyc w HistoryRowView zamiast dodawac duplikat `workingFluidLabel`. Sprawdzic co juz istnieje i nie duplikowac.

Istniejace klucze w LocalizationManager:
- `workingFluid` = "Ciecz robocza" / "Working fluid" -- UZYJ tego w HistoryRowView
- `chemical` = "Środek" / "Chemical" -- UZYJ tego
- `tankFills` = "Napełnienia opryskiwacza" / "Tank fills" -- label w historii to samo? Nie -- w historii jest krotsze "Napelnienia". Dodaj osobny `tankFillsShort` lub uzyj istniejacy `tankFills` (jest dluzszy ale akceptowalny).

Decyzja: Uzyj istniejace `workingFluid` i `chemical`. Dla "Napelnienia" uzyj istniejacy `tankFills` -- jest troche dluzszy ("Napelnienia opryskiwacza") ale poprawny. Lepsze niz duplikowanie.

Wiec potrzebne NOWE klucze to tylko:
- `version`
- `information`
- `calculating`

**2. Naprawic HistoryRowView w HistoryView.swift:**

HistoryRowView NIE ma dostepu do LocalizationManager. Dodac:
```swift
@Environment(LocalizationManager.self) private var localization
```

Zamienic hardcoded stringi:
- Linia 87: `"Ciecz robocza"` -> `localization.workingFluid`
- Linia 88: `"Środek"` -> `localization.chemical`
- Linia 89: `"Napełnienia"` -> `localization.tankFills`

Zamienic hardcoded tankFillsText:
- `"pełne"` -> `localization.fullTanks`
- `"częściowe"` -> `localization.partialTank`

Nowy tankFillsText:
```swift
private var tankFillsText: String {
    if calculation.hasPartialTank {
        return "\(calculation.fullTanks) \(localization.fullTanks) + 1 \(localization.partialTank) (\(formatNumber(calculation.partialTankVolume)) l)"
    }
    return "\(calculation.fullTanks) \(localization.fullTanks)"
}
```

**3. Naprawic SettingsView.swift:**

Zamienic hardcoded stringi:
- `Text("Wersja")` -> `Text(localization.version)`
- `Text("Informacje")` -> `Text(localization.information)`

**4. Naprawic TractorAnimation.swift:**

Problem: TractorSprayingAnimation nie ma dostepu do LocalizationManager.
Rozwiazanie: Dodac parametr `calculatingText: String` do TractorSprayingAnimation.

Zmienic:
```swift
struct TractorSprayingAnimation: View {
    let calculatingText: String
    // ... reszta bez zmian
    let onComplete: () -> Void

    // W body:
    Text(isAnimating ? calculatingText : "")
```

Zaktualizowac WSZYSTKIE miejsca tworzenia TractorSprayingAnimation:
- W CalculatorViewWithFavorite (ContentView.swift):
  ```swift
  TractorSprayingAnimation(calculatingText: localization.calculating) {
  ```
- W Preview na dole TractorAnimation.swift:
  ```swift
  TractorSprayingAnimation(calculatingText: "Obliczanie...") { }
  ```

**5. Przeszukac caly projekt na pozostale hardcoded polskie stringi:**

Wykonac: `grep -rn "pełne\|częściowe\|Obliczanie\|Wersja\|Informacje\|Ciecz robocza\|Środek\|Napełnienia" SprayCalculator/`

Jesli cokolwiek zostalo -- naprawic.

Wyjatki (OK do zostawienia):
- Wewnatrz LocalizationManager.swift -- tam polskie stringi sa po prawej stronie warunkow (to jest ich definicja)
- Preview providery moga miec hardcoded stringi (nie sa w produkcji)
  </action>
  <verify>
# Sprawdz ze HistoryRowView ma @Environment
grep "@Environment(LocalizationManager" SprayCalculator/HistoryView.swift

# Sprawdz ze nie ma hardcoded polskich stringow w widokach (poza LocalizationManager)
grep -n "\"Ciecz robocza\"\|\"Środek\"\|\"Napełnienia\"\|\"pełne\"\|\"częściowe\"" SprayCalculator/HistoryView.swift  # 0 wynikow
grep -n "\"Wersja\"\|\"Informacje\"" SprayCalculator/SettingsView.swift  # 0 wynikow
grep -n "\"Obliczanie\"" SprayCalculator/TractorAnimation.swift  # 0 wynikow (poza Preview)

# Sprawdz nowe klucze lokalizacji
grep "var version:" SprayCalculator/LocalizationManager.swift
grep "var information:" SprayCalculator/LocalizationManager.swift
grep "var calculating:" SprayCalculator/LocalizationManager.swift
  </verify>
  <done>Zero hardcoded polskich stringow w widokach (poza LocalizationManager gdzie sa definicje). Nowe klucze lokalizacji: version, information, calculating. HistoryRowView uzywa localization dla wszystkich labelow.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Kompletna faza 1: MVVM refaktor, @Observable migracja, per-tank composition (CALC-01/02/03), lokalizacja PL/EN</what-built>
  <how-to-verify>
1. Otworz projekt w Xcode: `open SprayCalculator.xcodeproj`
2. Zbuduj i uruchom na symulatorze (Cmd+R)
3. **Test obliczen:**
   - Wpisz: Powierzchnia=10ha, Dawka cieczy=200 l/ha, Dawka srodka=2 l/ha, Pojemnosc=500 l
   - Kliknij Oblicz -- powinna pojawic sie animacja traktora, potem wyniki
   - Sprawdz: Czy widac "Sklad pelnego zbiornika" z iloscia wody i srodka?
   - Sprawdz: Czy widac "Sklad niepelnego zbiornika" (jesli jest)?
   - Sprawdz: Czy widac "Srodek do kupienia" z sumaryczna iloscia?
4. **Test lokalizacji:**
   - Przejdz do Ustawienia (ikona zebatki)
   - Przelacz jezyk na English
   - Sprawdz: Czy w Ustawieniach widac "Version" i "Information" (nie "Wersja"/"Informacje")?
   - Wroc do kalkulatora, oblicz -- czy wyniki sa po angielsku?
   - Przejdz do Historii -- rozwin wpis -- czy widac "Working fluid", "Chemical", "Tank fills" (nie polskie)?
   - Czy "full" / "partial" jest po angielsku?
5. **Test istniejacych funkcji:**
   - Zapisz do ulubionych -- czy dziala?
   - Zaladuj z ulubionych -- czy wartosci sie wczytuja?
   - Wyczysc pola i kliknij Oblicz bez wypelniania -- czy pola sie trzesa?
  </how-to-verify>
  <resume-signal>Wpisz "zatwierdzone" jesli wszystko dziala, lub opisz problemy</resume-signal>
</task>

</tasks>

<verification>
1. FIX-01: HistoryRowView uzywa localization.workingFluid, .chemical, .tankFills zamiast hardcoded PL
2. FIX-02: SettingsView uzywa localization.version, .information zamiast hardcoded PL
3. FIX-01 dodatkowe: tankFillsText uzywa localization.fullTanks, .partialTank zamiast hardcoded "pelne"/"czesciowe"
4. TractorAnimation uzywa localization.calculating zamiast hardcoded "Obliczanie..."
5. Przelaczenie na EN: zero polskiego tekstu na zadnym ekranie
6. Przelaczenie na PL: wszystko po polsku jak wczesniej
7. Build: `xcodebuild build` bez bledow
</verification>

<success_criteria>
- Zero hardcoded polskich stringow w widokach (poza LocalizationManager)
- HistoryRowView ma @Environment(LocalizationManager.self) i uzywa go dla labelow i tankFillsText
- SettingsView uzywa localization.version i localization.information
- TractorAnimation przyjmuje calculatingText jako parametr
- Po przelaczeniu na EN: w pelni angielski UI na kazdym ekranie
- Weryfikacja czlowieka: potwierdzona prawidlowa praca aplikacji
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-mvvm/01-04-SUMMARY.md`
</output>
