---
phase: 02-visual-polish
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - SprayCalculator/ContentView.swift
  - SprayCalculator/FavoritesView.swift
  - SprayCalculator/HistoryView.swift
  - SprayCalculator/SettingsView.swift
  - SprayCalculator/TractorAnimation.swift
  - SprayCalculator/Colors.swift
autonomous: false

must_haves:
  truths:
    - "Toggling iOS dark mode produces a fully adapted UI with no white-on-white or invisible text on any screen"
    - "Setting Dynamic Type to maximum accessibility size keeps all screens usable -- no text clipping, no overlapping elements"
    - "In bright outdoor light, all input labels, buttons, and result numbers are clearly readable"
    - "No hardcoded Color literals remain in any view file -- all colors reference Asset Catalog semantic names"
    - "Colors.swift is deleted -- no old Color extension properties exist"
  artifacts:
    - path: "SprayCalculator/ContentView.swift"
      provides: "Calculator tab + favorites tab + history tab with adaptive colors"
      contains: "Color(.primaryGreen)"
    - path: "SprayCalculator/FavoritesView.swift"
      provides: "Favorites list with adaptive colors and semantic fonts"
      contains: "Color(.accentGold)"
    - path: "SprayCalculator/HistoryView.swift"
      provides: "History list with adaptive colors"
      contains: "Color(.textPrimary)"
    - path: "SprayCalculator/SettingsView.swift"
      provides: "Settings view with adaptive colors"
      contains: "Color(.backgroundCard)"
    - path: "SprayCalculator/TractorAnimation.swift"
      provides: "Tractor animation with adaptive card background and themed colors"
      contains: "Color(.primaryGreen)"
  key_links:
    - from: "SprayCalculator/ContentView.swift"
      to: "SprayCalculator/Theme/AppGradients.swift"
      via: "AppGradients.backgroundGradient reference"
      pattern: "AppGradients\\.backgroundGradient"
    - from: "All view files"
      to: "SprayCalculator/Assets.xcassets/Colors/"
      via: "Color(.name) type-safe references"
      pattern: "Color\\(\\.\\w+\\)"
---

<objective>
Migrate the remaining 5 view files (ContentView, FavoritesView, HistoryView, SettingsView, TractorAnimation) to the new Asset Catalog color system and semantic fonts established in Plan 02-01, delete the old Colors.swift file, and verify the complete UI in dark mode and at maximum Dynamic Type size.

Purpose: Completes the visual polish migration across the entire app. After this plan, zero hardcoded color literals remain and all screens adapt to dark mode and Dynamic Type.

Output: 5 migrated view files, Colors.swift deleted, human-verified dark mode and Dynamic Type behavior.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-visual-polish/02-RESEARCH.md
@.planning/phases/02-visual-polish/02-01-SUMMARY.md
@SprayCalculator/ContentView.swift
@SprayCalculator/FavoritesView.swift
@SprayCalculator/HistoryView.swift
@SprayCalculator/SettingsView.swift
@SprayCalculator/TractorAnimation.swift
@SprayCalculator/Colors.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ContentView, FavoritesView, HistoryView, SettingsView to new color system</name>
  <files>
    SprayCalculator/ContentView.swift
    SprayCalculator/FavoritesView.swift
    SprayCalculator/HistoryView.swift
    SprayCalculator/SettingsView.swift
  </files>
  <action>
    Apply the same migration pattern established in 02-01 for Components.swift to all 4 view files. Read each file, replace every old-style Color reference with the new Asset Catalog syntax, replace hardcoded fonts with semantic text styles, and use .foregroundStyle instead of .foregroundColor.

    **ContentView.swift** (3 color refs):
    - `.foregroundColor(.primaryGreen)` → `.foregroundStyle(Color(.primaryGreen))` (settings gear icon)
    - `.tint(.primaryGreen)` → `.tint(Color(.primaryGreen))` (TabView tint)
    - `LinearGradient.backgroundGradient` → `AppGradients.backgroundGradient` (CalculatorViewWithFavorite background)
    - `.tint(.primaryGreen)` on save button → `.tint(Color(.primaryGreen))`
    - `.foregroundColor(.textSecondary)` on area unit label → `.foregroundStyle(Color(.textSecondary))`
    - Add dark mode + max Dynamic Type previews:
      ```swift
      #Preview("Dark Mode") {
          ContentView()
              .environment(LocalizationManager())
              .environment(HistoryManager())
              .environment(FavoritesManager())
              .preferredColorScheme(.dark)
      }

      #Preview("Max Dynamic Type") {
          ContentView()
              .environment(LocalizationManager())
              .environment(HistoryManager())
              .environment(FavoritesManager())
              .dynamicTypeSize(.accessibility5)
      }
      ```

    **FavoritesView.swift** (7 color refs):
    - `.foregroundColor(.textSecondary.opacity(0.5))` → `.foregroundStyle(Color(.textSecondary).opacity(0.5))`
    - `.foregroundColor(.textSecondary)` → `.foregroundStyle(Color(.textSecondary))` (multiple)
    - `.foregroundColor(.accentGold)` → `.foregroundStyle(Color(.accentGold))`
    - `.foregroundColor(.textPrimary)` → `.foregroundStyle(Color(.textPrimary))`
    - `.foregroundColor(.white)` → `.foregroundStyle(.white)` (keep white on green capsule -- high contrast OK)
    - `Color.primaryGreen` → `Color(.primaryGreen)` (capsule fill)
    - `Color.backgroundCard` → `Color(.backgroundCard)` (card background)
    - `.foregroundColor(.primaryGreen)` → `.foregroundStyle(Color(.primaryGreen))` (MiniDetailView icon)
    - `LinearGradient.backgroundGradient` → `AppGradients.backgroundGradient`
    - `.black.opacity(0.05)` → `Color(.textPrimary).opacity(0.05)` (shadow)
    - Empty state icon `.font(.system(size: 60))` -- keep as-is (decorative, fixed size is fine)

    **HistoryView.swift** (6 color refs):
    - `.foregroundColor(.textSecondary.opacity(0.5))` → `.foregroundStyle(Color(.textSecondary).opacity(0.5))`
    - `.foregroundColor(.textSecondary)` → `.foregroundStyle(Color(.textSecondary))` (multiple)
    - `.foregroundColor(.textPrimary)` → `.foregroundStyle(Color(.textPrimary))` (multiple)
    - `.foregroundColor(.error)` → `.foregroundStyle(Color(.errorRed))` (trash icon)
    - `Color.backgroundCard` → `Color(.backgroundCard)` (card background)
    - `LinearGradient.backgroundGradient` → `AppGradients.backgroundGradient`
    - `.black.opacity(0.05)` → `Color(.textPrimary).opacity(0.05)` (shadow)
    - Empty state icon `.font(.system(size: 60))` -- keep as-is (decorative)

    **SettingsView.swift** (4 color refs):
    - `.foregroundColor(.textSecondary)` → `.foregroundStyle(Color(.textSecondary))` (section headers, version text)
    - `Color.backgroundCard` → `Color(.backgroundCard)` (listRowBackground)
    - `LinearGradient.backgroundGradient` → `AppGradients.backgroundGradient`
    - `.foregroundColor(.primaryGreen)` → `.foregroundStyle(Color(.primaryGreen))` (checkmark icon)
    - `.foregroundColor(.textPrimary)` → `.foregroundStyle(Color(.textPrimary))` (language name)
  </action>
  <verify>
    1. Zero old-style Color.extensionName in all 4 files:
       `grep -n 'Color\.\(primaryGreen\|textPrimary\|textSecondary\|backgroundLight\|backgroundCard\|backgroundDark\|lightGreen\|darkGreen\|earthBrown\|lightBrown\|darkBrown\|accentGold\|waterBlue\|error\)' SprayCalculator/ContentView.swift SprayCalculator/FavoritesView.swift SprayCalculator/HistoryView.swift SprayCalculator/SettingsView.swift` returns nothing
    2. Zero `.foregroundColor(` in all 4 files:
       `grep -c '.foregroundColor' SprayCalculator/ContentView.swift SprayCalculator/FavoritesView.swift SprayCalculator/HistoryView.swift SprayCalculator/SettingsView.swift` should all be 0
    3. Zero `LinearGradient.` static references (old gradient syntax):
       `grep -c 'LinearGradient\.\(primaryGradient\|earthGradient\|backgroundGradient\)' SprayCalculator/ContentView.swift SprayCalculator/FavoritesView.swift SprayCalculator/HistoryView.swift SprayCalculator/SettingsView.swift` should all be 0
    4. AppGradients.backgroundGradient used in ContentView, FavoritesView, HistoryView, SettingsView:
       `grep -l 'AppGradients\.backgroundGradient' SprayCalculator/ContentView.swift SprayCalculator/FavoritesView.swift SprayCalculator/HistoryView.swift SprayCalculator/SettingsView.swift | wc -l` should output 4
  </verify>
  <done>
    ContentView, FavoritesView, HistoryView, and SettingsView have zero hardcoded Color.extensionName references, use .foregroundStyle instead of .foregroundColor, and reference AppGradients for all gradient backgrounds. ContentView includes dark mode and max Dynamic Type preview macros.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate TractorAnimation.swift and delete Colors.swift</name>
  <files>
    SprayCalculator/TractorAnimation.swift
    SprayCalculator/Colors.swift
    SprayCalculator.xcodeproj/project.pbxproj
  </files>
  <action>
    **TractorAnimation.swift migration** (14 color refs, 1 font ref):

    The tractor animation is decorative -- keep all frame sizes fixed (no @ScaledMetric). But migrate all color references to Asset Catalog:

    - TractorSprayingAnimation:
      - `.foregroundColor(.white)` → `.foregroundStyle(.white)` (loading text -- white on dark overlay, OK in both modes)
      - `Color.backgroundCard` → `Color(.backgroundCard)` (animation card background)
      - `LinearGradient.earthGradient` → `AppGradients.earthGradient` (ground line)
      - `.font(.system(size: 16, weight: .medium, design: .rounded))` → `.font(.callout.weight(.medium))` then add `.fontDesign(.rounded)`

    - SprayDropView:
      - `Color.waterBlue.opacity(0.8)` → `Color(.waterBlue).opacity(0.8)`

    - TractorView:
      - `Color.primaryGreen` → `Color(.primaryGreen)` (sprayer tank, hood -- 2 occurrences)
      - `Color.gray` → `Color.gray` (keep system gray -- it already adapts to dark mode natively)
      - `Color.darkGreen` → `Color(.darkGreen)` (cabin)
      - `Color.waterBlue.opacity(0.5)` → `Color(.waterBlue).opacity(0.5)` (window)

    - WheelView:
      - `Color.darkBrown` → `Color(.darkBrown)` (tire)
      - `Color.gray` → `Color.gray` (rim -- keep system gray)
      - `Color.gray.opacity(0.7)` → `Color.gray.opacity(0.7)` (spokes -- keep system gray)
      - `Color.accentGold` → `Color(.accentGold)` (center hub)

    - SprayNozzle:
      - `Color.gray` → `Color.gray` (keep system gray)
      - `Color.waterBlue.opacity(0.4)` → `Color(.waterBlue).opacity(0.4)` (spray cone)

    **Delete Colors.swift:**

    1. Delete the file: `rm SprayCalculator/Colors.swift`
    2. Remove from `project.pbxproj`: Remove the PBXFileReference for Colors.swift and its PBXBuildFile entry from the Sources build phase. Search for "Colors.swift" in the pbxproj and remove ALL lines referencing it (there will be ~3-4 lines: PBXFileReference, PBXBuildFile, and the reference in the PBXGroup children array and PBXSourcesBuildPhase files array).
    3. Also remove the `LinearGradient` extension static properties since they are now in AppGradients.swift.

    **Full-project verify:**
    After deletion, grep ALL Swift files for any remaining references to the old Color extension names. If any are found, fix them before completing.
  </action>
  <verify>
    1. TractorAnimation.swift has zero old-style Color.extensionName refs (except Color.gray which is a system color):
       `grep -n 'Color\.\(primaryGreen\|darkGreen\|darkBrown\|waterBlue\|accentGold\|backgroundCard\|earthBrown\)' SprayCalculator/TractorAnimation.swift` returns nothing
    2. Colors.swift is deleted: `test -f SprayCalculator/Colors.swift && echo "EXISTS" || echo "DELETED"` should output "DELETED"
    3. Colors.swift removed from pbxproj: `grep -c 'Colors.swift' SprayCalculator.xcodeproj/project.pbxproj` should output 0
    4. ZERO old Color.extension references across entire project:
       `grep -rn 'Color\.\(primaryGreen\|textPrimary\|textSecondary\|backgroundLight\|backgroundCard\|backgroundDark\|lightGreen\|darkGreen\|earthBrown\|lightBrown\|darkBrown\|accentGold\|waterBlue\|error\)' SprayCalculator/*.swift SprayCalculator/**/*.swift 2>/dev/null` returns nothing
    5. ZERO old LinearGradient.staticName references:
       `grep -rn 'LinearGradient\.\(primaryGradient\|earthGradient\|backgroundGradient\)' SprayCalculator/*.swift SprayCalculator/**/*.swift 2>/dev/null` returns nothing
    6. Zero `.foregroundColor` in TractorAnimation.swift:
       `grep -c '.foregroundColor' SprayCalculator/TractorAnimation.swift` should output 0
  </verify>
  <done>
    TractorAnimation.swift fully migrated to Color(.name) syntax and .foregroundStyle. Colors.swift deleted from filesystem and removed from Xcode project. Zero old-style Color.extensionName or LinearGradient.staticName references remain in any Swift file in the entire project.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete visual polish migration across all view files:
    - 18 Asset Catalog color sets with light + dark mode variants
    - AppGradients.swift with adaptive gradients
    - All 7 view files migrated to Color(.name) syntax, semantic fonts, .foregroundStyle
    - Components.swift has @ScaledMetric for Dynamic Type scaling of non-text dimensions
    - Colors.swift deleted (old hardcoded colors removed)
  </what-built>
  <how-to-verify>
    Build and run the app on Simulator or device, then verify these 4 criteria:

    **1. Dark Mode (UI-01):**
    - Open Settings app on device/simulator → Display & Brightness → Dark
    - Return to the spray calculator app
    - Check: Calculator tab background is dark (not white), card backgrounds are dark gray, text is light colored
    - Check: Input fields have visible borders/shadows against dark background
    - Check: Green buttons and accents remain vibrant
    - Check: History tab -- cards visible, text readable, no invisible elements
    - Check: Favorites tab -- star icon visible (gold), "Use" button readable
    - Check: Settings tab -- rows visible, checkmark visible
    - Check: Tractor animation -- card visible, tractor colors distinguishable from background
    - CRITICAL: No white-on-white or black-on-black text anywhere

    **2. Dynamic Type at Max Size (UI-02):**
    - Open Settings app → Accessibility → Display & Text Size → Larger Text → slide to maximum
    - Return to calculator app
    - Check: All text is larger and readable
    - Check: Input fields expand to accommodate larger text (padding scales)
    - Check: Result cards icon circles scale up proportionally
    - Check: No text is clipped or overlapping
    - Check: Content remains scrollable on all tabs
    - Check: Button text wraps or expands gracefully

    **3. Outdoor Readability (UI-03):**
    - In light mode at normal Dynamic Type:
    - Check: Input labels are clearly visible (not faint gray-on-white)
    - Check: Result numbers are bold and high-contrast
    - Check: Green buttons have clear white text
    - Check: Section headers are prominent

    **4. Code Quality:**
    - Xcode build produces zero color-related warnings
    - No "unable to find color" or nil color warnings in console
  </how-to-verify>
  <resume-signal>Type "approved" if all 4 checks pass, or describe specific issues (e.g., "text invisible on History tab in dark mode", "input field padding too large at max Dynamic Type")</resume-signal>
</task>

</tasks>

<verification>
1. Colors.swift deleted: `test -f SprayCalculator/Colors.swift && echo "FAIL" || echo "PASS"`
2. Zero old Color.extension references in project: `grep -rn 'Color\.\(primaryGreen\|textPrimary\|textSecondary\|backgroundLight\|backgroundCard\|backgroundDark\)' SprayCalculator/*.swift SprayCalculator/**/*.swift 2>/dev/null | wc -l` == 0
3. Zero `.foregroundColor` across all view files: `grep -rn '.foregroundColor' SprayCalculator/ContentView.swift SprayCalculator/FavoritesView.swift SprayCalculator/HistoryView.swift SprayCalculator/SettingsView.swift SprayCalculator/Components.swift SprayCalculator/TractorAnimation.swift 2>/dev/null | wc -l` == 0
4. Zero `LinearGradient.` static references: `grep -rn 'LinearGradient\.\(primaryGradient\|earthGradient\|backgroundGradient\)' SprayCalculator/*.swift 2>/dev/null | wc -l` == 0
5. All view files use Color(.name) syntax: `grep -l 'Color(\.' SprayCalculator/ContentView.swift SprayCalculator/FavoritesView.swift SprayCalculator/HistoryView.swift SprayCalculator/SettingsView.swift SprayCalculator/Components.swift SprayCalculator/TractorAnimation.swift | wc -l` == 6
6. Human verified dark mode, Dynamic Type, and outdoor readability
</verification>

<success_criteria>
- All 5 remaining view files migrated to Asset Catalog colors with .foregroundStyle and semantic fonts
- Colors.swift deleted and removed from Xcode project
- Zero hardcoded Color literals remain in any view file across entire project
- Human confirms: dark mode fully adapted, Dynamic Type at max size usable, outdoor readability good
- Phase 2 success criteria met: UI-01, UI-02, UI-03 requirements delivered
</success_criteria>

<output>
After completion, create `.planning/phases/02-visual-polish/02-02-SUMMARY.md`
</output>
